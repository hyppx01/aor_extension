**â€œæ‰‹åŠ¨ç²˜è´´å†…å®¹â€**å¹¶æ¨é€åˆ° GitHubï¼Œ**â€œå¸¦æœ‰ GitHub API å‘å¸ƒåŠŸèƒ½çš„ Markdown ç¼–è¾‘å™¨â€**ã€‚

åœ¨ Chrome æ‰©å±•ä¸­æ›´æ–° GitHub ä»“åº“ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ **GitHub REST API** çš„ `Contents` æ¥å£å‘é€ `PUT` è¯·æ±‚ã€‚

ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆï¼š

### 1. æ ¸å¿ƒåŸç†

*   **API æ¥å£**: `PUT /repos/{owner}/{repo}/contents/{path}/{filename}`
*   **è®¤è¯æ–¹å¼**: ä½¿ç”¨ GitHub Personal Access Token (PAT) æ”¾å…¥è¯·æ±‚å¤´ã€‚
*   **æ•°æ®ç¼–ç **: GitHub API è¦æ±‚æ–‡ä»¶å†…å®¹å¿…é¡»æ˜¯ **Base64** ç¼–ç ã€‚
*   **ä¸­æ–‡é—®é¢˜**: JavaScript åŸç”Ÿçš„ `btoa()` ä¸æ”¯æŒä¸­æ–‡ï¼ˆUTF-8ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ç‰¹æ®Šå¤„ç†è½¬æ¢ç¼–ç ï¼Œå¦åˆ™åšå®¢æ˜¾ç¤ºçš„ä¸­æ–‡ä¼šä¹±ç ã€‚

### 2. è¯¦ç»†ä»£ç å®ç°

ä½ éœ€è¦ä¿®æ”¹ `manifest.json` å’Œ `popup.js`ã€‚

#### ç¬¬ä¸€æ­¥ï¼šé…ç½® Manifest (manifest.json)
ä½ éœ€è¦ `host_permissions` æ¥å…è®¸æ‰©å±•å‘ GitHub å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸éœ€è¦è·¨åŸŸä»£ç†ã€‚

```json
{
  "manifest_version": 3,
  "name": "AI Output Clipper",
  "version": "1.0.0",
  "action": {
    "default_popup": "popup.html"
  },
  "permissions": [
    "storage" 
  ],
  "host_permissions": [
    "https://api.github.com/*"
  ]
}
```

#### ç¬¬äºŒæ­¥ï¼šç•Œé¢è®¾è®¡ (popup.html)
ç§»é™¤è‡ªåŠ¨æŠ“å–é€»è¾‘ï¼Œæä¾›å¹²å‡€çš„è¾“å…¥æ¡†ä¾›ä½ ç²˜è´´ã€‚

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { width: 400px; padding: 15px; font-family: sans-serif; }
    input, textarea { width: 100%; box-sizing: border-box; margin-bottom: 10px; padding: 8px; }
    textarea { height: 200px; resize: vertical; font-family: monospace; }
    button { width: 100%; padding: 10px; background: #1a1a1a; color: #fff; border: none; cursor: pointer; }
    button:disabled { background: #ccc; }
    .config { border-top: 1px solid #eee; margin-top: 15px; padding-top: 10px; }
    label { font-size: 12px; font-weight: bold; color: #666; display: block; margin-bottom: 4px; }
  </style>
</head>
<body>
  <!-- æ–‡ç« è¾“å…¥åŒº -->
  <div>
    <label>æ–‡ç« æ ‡é¢˜ (ä½œä¸ºæ–‡ä»¶å)</label>
    <input type="text" id="title" placeholder="ä¾‹å¦‚: å¦‚ä½•ä½¿ç”¨ Next.js">
    
    <label>Markdown å†…å®¹ (ç›´æ¥ç²˜è´´)</label>
    <textarea id="content" placeholder="# ç²˜è´´ä½ çš„å†…å®¹..."></textarea>
    
    <button id="publish-btn">å‘å¸ƒåˆ°åšå®¢</button>
    <p id="status" style="font-size:12px; text-align:center; color:#666;"></p>
  </div>

  <!-- é…ç½®åŒº (ç¬¬ä¸€æ¬¡è®¾ç½®å¥½å³å¯) -->
  <div class="config">
    <details>
      <summary style="cursor:pointer; font-size:12px;">GitHub é…ç½® (ç‚¹å‡»å±•å¼€)</summary>
      <br>
      <input type="password" id="gh-token" placeholder="GitHub Token (PAT)">
      <input type="text" id="gh-owner" placeholder="ç”¨æˆ·å (ä¾‹å¦‚ jclio)">
      <input type="text" id="gh-repo" placeholder="ä»“åº“å (ä¾‹å¦‚ ai_output_retention)">
      <button id="save-config-btn" style="background:#444;">ä¿å­˜é…ç½®</button>
    </details>
  </div>

  <script src="popup.js"></script>
</body>
</html>
```

#### ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒé€»è¾‘ (popup.js)
è¿™æ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ï¼ŒåŒ…å«äº†**ä¸­æ–‡è½¬Base64**å’Œ**GitHub API è°ƒç”¨**ã€‚

```javascript
document.addEventListener('DOMContentLoaded', async () => {
  // 1. åŠ è½½ä¿å­˜çš„é…ç½®
  const config = await chrome.storage.sync.get(['ghToken', 'ghOwner', 'ghRepo']);
  if (config.ghToken) document.getElementById('gh-token').value = config.ghToken;
  if (config.ghOwner) document.getElementById('gh-owner').value = config.ghOwner;
  if (config.ghRepo) document.getElementById('gh-repo').value = config.ghRepo;

  // 2. ä¿å­˜é…ç½®åŠŸèƒ½
  document.getElementById('save-config-btn').addEventListener('click', () => {
    const ghToken = document.getElementById('gh-token').value.trim();
    const ghOwner = document.getElementById('gh-owner').value.trim();
    const ghRepo = document.getElementById('gh-repo').value.trim();
    
    chrome.storage.sync.set({ ghToken, ghOwner, ghRepo }, () => {
      showStatus('âœ… é…ç½®å·²ä¿å­˜');
    });
  });

  // 3. å‘å¸ƒåŠŸèƒ½
  document.getElementById('publish-btn').addEventListener('click', async () => {
    const btn = document.getElementById('publish-btn');
    const title = document.getElementById('title').value.trim();
    const bodyContent = document.getElementById('content').value;
    
    // åŸºç¡€æ ¡éªŒ
    const { ghToken, ghOwner, ghRepo } = await chrome.storage.sync.get(['ghToken', 'ghOwner', 'ghRepo']);
    if (!ghToken || !ghOwner || !ghRepo) {
      showStatus('âŒ è¯·å…ˆå¡«å†™ä¸‹æ–¹çš„ GitHub é…ç½®');
      return;
    }
    if (!title || !bodyContent) {
      showStatus('âŒ æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
      return;
    }

    btn.disabled = true;
    btn.innerText = "æ­£åœ¨æ¨é€...";

    try {
      // --- å…³é”®æ­¥éª¤ A: æ„é€ æ–‡ä»¶å†…å®¹ ---
      const dateStr = new Date().toISOString().split('T')[0]; // 2024-12-30
      const finalMarkdown = `---
title: "${title}"
date: "${dateStr}"
---

${bodyContent}`;

      // --- å…³é”®æ­¥éª¤ B: å¤„ç†ä¸­æ–‡ç¼–ç  ---
      // å¿…é¡»è¿™æ ·åšï¼Œå¦åˆ™ä¸­æ–‡ä¼šä¹±ç 
      const contentBase64 = btoa(unescape(encodeURIComponent(finalMarkdown)));

      // --- å…³é”®æ­¥éª¤ C: ç”Ÿæˆæ–‡ä»¶å ---
      // å°†æ ‡é¢˜è½¬ä¸º URL å‹å¥½çš„ slugï¼Œä¾‹å¦‚ "Hello World" -> "hello-world.md"
      // ç®€å•çš„å¤„ç†ï¼šè½¬å°å†™ï¼Œæ›¿æ¢éå­—æ¯æ•°å­—ä¸ºæ¨ªçº¿
      // å¦‚æœä½ å¸Œæœ›ç”¨æ—¥æœŸåšå‰ç¼€ï¼Œå¯ä»¥åŠ : `${dateStr}-${slug}.md`
      const slug = title.toLowerCase()
        .replace(/[^\w\u4e00-\u9fa5]+/g, '-') // ä¿ç•™ä¸­æ–‡å’Œè‹±æ–‡æ•°å­—ï¼Œå…¶ä»–è½¬æ¨ªçº¿
        .replace(/^-+|-+$/g, '') || 'untitled-' + Date.now();
      const filename = `${slug}.md`;

      // --- å…³é”®æ­¥éª¤ D: è°ƒç”¨ GitHub API ---
      // è·¯å¾„é»˜è®¤å­˜æ”¾åœ¨ posts/ ä¸‹
      const filePath = `posts/${filename}`;
      const apiUrl = `https://api.github.com/repos/${ghOwner}/${ghRepo}/contents/${filePath}`;

      const response = await fetch(apiUrl, {
        method: 'PUT',
        headers: {
          'Authorization': `token ${ghToken}`,
          'Content-Type': 'application/json',
          'Accept': 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          message: `Add post: ${title}`, // Commit message
          content: contentBase64
        })
      });

      if (response.ok) {
        showStatus('ğŸ‰ å‘å¸ƒæˆåŠŸï¼Cloudflare æ­£åœ¨æ„å»º...');
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('title').value = '';
        document.getElementById('content').value = '';
      } else {
        const errorData = await response.json();
        console.error(errorData);
        showStatus(`âŒ å¤±è´¥: ${errorData.message}`);
      }
    } catch (e) {
      showStatus(`âŒ ç½‘ç»œé”™è¯¯: ${e.message}`);
    } finally {
      btn.disabled = false;
      btn.innerText = "å‘å¸ƒåˆ°åšå®¢";
    }
  });
});

function showStatus(msg) {
  const el = document.getElementById('status');
  el.textContent = msg;
  // 3ç§’åæ¸…é™¤
  setTimeout(() => el.textContent = '', 5000);
}
```

### 3. ä½¿ç”¨æµç¨‹

1.  **è·å– Token**:
    *   å» GitHub -> Settings -> Developer settings -> Personal access tokens (Tokens (classic))ã€‚
    *   Generate new token -> å‹¾é€‰ `repo` æƒé™ï¼ˆå¦‚æœæ˜¯ç§æœ‰åº“ï¼‰æˆ–è€… `public_repo`ï¼ˆå¦‚æœæ˜¯å…¬å¼€åº“ï¼‰ã€‚
2.  **é…ç½®æ‰©å±•**:
    *   ç‚¹å‡»æ‰©å±•å›¾æ ‡ï¼Œå±•å¼€ä¸‹æ–¹çš„ "GitHub é…ç½®"ã€‚
    *   å¡«å…¥ Token, ç”¨æˆ·å (jclio), ä»“åº“å (ai_output_retention)ã€‚
    *   ç‚¹å‡»ä¿å­˜ã€‚
3.  **æ—¥å¸¸ä½¿ç”¨**:
    *   åœ¨ ChatGPT å¤åˆ¶å†…å®¹ã€‚
    *   æ‰“å¼€æ‰©å±•ï¼Œç²˜è´´åˆ°å†…å®¹æ¡†ï¼Œè¾“å…¥æ ‡é¢˜ã€‚
    *   ç‚¹å‡»â€œå‘å¸ƒâ€ã€‚
    *   æ‰©å±•ä¼šç›´æ¥åœ¨ä½ çš„ GitHub ä»“åº“ `posts/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ `.md` æ–‡ä»¶ï¼ŒCloudflare Pages æ£€æµ‹åˆ°æ–° Commit åä¼šè‡ªåŠ¨éƒ¨ç½²æ›´æ–°ã€‚

### 4. å¸¸è§é—®é¢˜æ’æŸ¥

*   **HTTP 401 Unauthorized**: Token å¡«é”™äº†æˆ–è€…è¿‡æœŸäº†ã€‚
*   **HTTP 404 Not Found**: ç”¨æˆ·åæˆ–ä»“åº“åå†™é”™äº†ï¼Œæˆ–è€… Token æ²¡æœ‰ `repo` æƒé™å¯¼è‡´çœ‹ä¸åˆ°ç§æœ‰åº“ã€‚
*   **HTTP 422 Unprocessable Entity**: é€šå¸¸æ˜¯å› ä¸ºæ–‡ä»¶åå·²ç»å­˜åœ¨ï¼ˆGitHub ä¸å…è®¸ PUT è¦†ç›–æ–‡ä»¶ï¼Œé™¤éæä¾›äº† sha å€¼ï¼‰ã€‚æˆ‘çš„ä»£ç é‡Œä½¿ç”¨äº† slugï¼Œå¦‚æœæ ‡é¢˜å®Œå…¨ä¸€æ ·å¯èƒ½ä¼šå†²çªï¼Œå»ºè®®æ ‡é¢˜åŠ ä¸Šæ—¥æœŸåŒºåˆ†æˆ–æ‰‹åŠ¨å¾®è°ƒæ ‡é¢˜ã€‚
*   **ä¹±ç **: ç¡®ä¿ä½¿ç”¨äº† `btoa(unescape(encodeURIComponent(str)))` è¿™ä¸€è¡Œä»£ç ã€‚